syntax = "proto3";

option go_package = "gen/lorepb";

package lore;

service LoreService {
  rpc GenerateCharacters (CharactersRequest) returns (stream CharactersStreamResponse);
  rpc GenerateFactions (FactionsRequest) returns (stream FactionsStreamResponse);
  rpc GenerateSettings (SettingsRequest) returns (stream SettingsStreamResponse);
  rpc GenerateEvents (EventsRequest) returns (stream EventsStreamResponse);
  rpc GenerateRelics (RelicsRequest) returns (stream RelicsStreamResponse);
  rpc GenerateAll (AllRequest) returns (AllResponse);
  rpc GenerateFullStory (FullStoryRequest) returns (FullStoryResponse);
  rpc GenerateEmbedding (EmbeddingRequest) returns (EmbeddingResponse);
  rpc RerankResults (RerankSearchRequest) returns (RerankSearchResponse);
  rpc UploadImageToR2 (UploadImageRequest) returns (UploadImageResponse);
  rpc GenerateWorldImage (GenerateWorldImageRequest) returns (GenerateWorldImageResponse);
}

message CharactersRequest {
  string theme = 1;
  int32 count = 2;
}
message FactionsRequest {
  string theme = 1;
  int32 count = 2;
}

message SettingsRequest {
  string theme = 1;
  int32 count = 2;
}

message EventsRequest {
  string theme = 1;
  int32 count = 2;
  LorePiece selected_setting = 3;
}

message RelicsRequest {
  string theme = 1;
  int32 count = 2;
  LorePiece selected_setting = 3;
  LorePiece selected_event = 4;
}

message LorePiece {
  string name = 1;
  string description = 2;
  map<string, string> details = 3;
  string type = 4;
}

message CharactersResponse {
  repeated LorePiece characters = 1;
}

message FactionsResponse {
  repeated LorePiece factions = 1;
}

message SettingsResponse {
  repeated LorePiece settings = 1;
}

message EventsResponse {
  repeated LorePiece events = 1;
}

message RelicsResponse {
  repeated LorePiece relics = 1;
}

// Progress tracking for streaming responses
message GenerationProgress {
  int32 progress = 1;
  string message = 2;
}

// Streaming response messages
message CharactersStreamResponse {
  oneof response {
    GenerationProgress progress = 1;
    CharactersResponse final = 2;
  }
}

message FactionsStreamResponse {
  oneof response {
    GenerationProgress progress = 1;
    FactionsResponse final = 2;
  }
}

message SettingsStreamResponse {
  oneof response {
    GenerationProgress progress = 1;
    SettingsResponse final = 2;
  }
}

message EventsStreamResponse {
  oneof response {
    GenerationProgress progress = 1;
    EventsResponse final = 2;
  }
}

message RelicsStreamResponse {
  oneof response {
    GenerationProgress progress = 1;
    RelicsResponse final = 2;
  }
}

message AllRequest {
  string theme = 1;
  int32 count = 2;
}

message AllResponse {
  repeated LorePiece characters = 1;
  repeated LorePiece factions = 2;
  repeated LorePiece settings = 3;
  repeated LorePiece events = 4;
  repeated LorePiece relics = 5;
}

message SelectedLorePieces {
  LorePiece character = 1;
  LorePiece faction = 2;
  LorePiece setting = 3;
  LorePiece event = 4;
  LorePiece relic = 5;
}

message FullStory {
  string content = 1;
  string theme = 2;
  SelectedLorePieces pieces = 3;
  map<string, string> quest = 4;
}

message FullStoryRequest {
  SelectedLorePieces pieces = 1;
  string theme = 2;
}

message FullStoryResponse {
  FullStory story = 1;
}

message EmbeddingRequest {
  string text = 1;
}

message EmbeddingResponse {
  repeated float embedding = 1;
}

message WorldResult {
  string title = 1;
  string theme = 2;
  string full_story = 3;
  float relevance = 4;
  repeated float embedding = 5;
}

message RerankSearchRequest {
  string query = 1;
  repeated WorldResult worlds = 2;
  repeated float query_embedding = 3;
}

message RerankSearchResponse {
  repeated WorldResult reranked_worlds = 1;
}

message UploadImageRequest {
  string image_base64 = 1;
  int64 world_id = 2;
  string character_id = 3;
  string image_type = 4;
}

message UploadImageResponse {
  string image_url = 1;
}

message GenerateWorldImageRequest {
  string world_title = 1;
  string full_story = 2;
  string theme = 3;
  string setting_description = 4;
  bool use_replicate = 5;
}

message GenerateWorldImageResponse {
  string image_base64 = 1;
}